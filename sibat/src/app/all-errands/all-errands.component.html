<div class="admin-container">
  <h2>All Errands</h2>

  <div class="stats">
    <div class="stat-card">
      <p>Total Errands</p>
      <h3>{{ totalErrands }}</h3>
    </div>
    <div class="stat-card">
      <p>Total Remitted</p>
      <h3>{{ totalRemitted }}</h3>
    </div>
    <div class="stat-card">
      <p>Total Pending</p>
      <h3>{{ totalPending }}</h3>
    </div>
    <div class="stat-card">
      <p>Total Not Yet</p>
      <h3>{{ totalNotYet }}</h3>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <input
      type="text"
      placeholder="Search by ID, user, runner, or status"
      [(ngModel)]="searchTerm"
      (input)="applyFilters()" />

    <select [(ngModel)]="remittedFilter" (change)="applyFilters()">
      <option value="ALL">All</option>
      <option value="Not Yet">Not Yet</option>
      <option value="Pending">Pending</option>
      <option value="Remitted">Remitted</option>
    </select>
  </div>

  <!-- Desktop Table -->
  <div class="table-container" *ngIf="!isMobile && filteredErrands.length">
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>User</th>
          <th>Runner</th>
        <th>Rating</th>
        <th>Rate Notes</th>
          <th>Total</th>
          <th>Remitted</th>
          <th>Proof</th>
          <th>Action</th>

          <th>Created</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let e of filteredErrands" (click)="viewDetails(e)">
          <td>{{ e.errand_id }}</td>
          <td>{{ e.user_name }}</td>
          <td>{{ e.runner_name || '—' }}</td>
        <td>{{ e.rating || '—' }}/5</td>
        <td>{{ e.rate_notes || '—' }}</td>
          <td>₱{{ e.total_price | number:'1.2-2' }}</td>

          <td>
            <span
              [class.notyet]="e.remitted === 'Not Yet'"
              [class.pending]="e.remitted === 'Pending'"
              [class.remitted]="e.remitted === 'Remitted'">
              {{ e.remitted }}
            </span>
          </td>
    

          <td>
            <a *ngIf="e.proof" [href]="getProofUrl(e.proof)" target="_blank">
              View
            </a>
            <span *ngIf="!e.proof">—</span>
          </td>
          <td>
<button
  *ngIf="e.remitted === 'Pending'" class="btn-remit"
  (click)="markRemitted(e.errand_id); $event.stopPropagation()">
  Mark as Remitted
</button>


  <span *ngIf="e.remitted === 'Remitted'">✔</span>
</td>


          <td>{{ e.created_at | date:'MMM dd, yyyy' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mobile Cards -->
  <div class="cards" *ngIf="isMobile && filteredErrands.length">
    <div class="card" *ngFor="let e of filteredErrands" (click)="viewDetails(e)">
      <p><strong>ID:</strong> {{ e.errand_id }}</p>
      <p><strong>User:</strong> {{ e.user_name }}</p>
      <p><strong>Runner:</strong> {{ e.runner_name || '—' }}</p>
      <p><strong>Rating:</strong> {{ e.rating || '—' }}/5</p>
      <p><strong>Notes:</strong> {{ e.rate_notes || '—' }}</p>
      <p><strong>Status:</strong> {{ e.status }}</p>
      <p><strong>Remitted:</strong> {{ e.remitted }}</p>
      <p class="tap-hint">Tap to view details</p>
      <button
  *ngIf="e.remitted === 'Pending'" class="btn-remit"
  (click)="markRemitted(e.errand_id); $event.stopPropagation()">
  Mark as Remitted
</button>
    </div>
  </div>

  <p *ngIf="filteredErrands.length === 0" class="empty">No errands found.</p>
</div>
